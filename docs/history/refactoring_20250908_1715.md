# MessageRenderer Tauri Command ì²˜ë¦¬ êµ¬ì¡° ê°œì„  ë¦¬íŒ©í† ë§

## ì‘ì—…ì˜ ëª©ì 

MessageRenderer ì»´í¬ë„ŒíŠ¸ì˜ Tauri ëª…ë ¹ì–´ ì²˜ë¦¬ë¥¼ ë™ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ê°œì„ í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ AI ì„œë¹„ìŠ¤ í˜¸í™˜ì„±ì„ í–¥ìƒì‹œí‚¨ë‹¤.

### ì£¼ìš” ëª©í‘œ

- í•˜ë“œì½”ë”©ëœ Tauri ëª…ë ¹ì–´ switchë¬¸ì„ ë™ì  ì²˜ë¦¬ë¡œ ëŒ€ì²´
- AI ì„œë¹„ìŠ¤ë³„ tool chain ì œì•½ì‚¬í•­ ì¤€ìˆ˜ (Anthropic, Gemini ë“±)
- ì½”ë“œ ì¤‘ë³µ ì œê±° ë° ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì ìš©
- ë³´ì•ˆ ê°•í™” (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ëª…ë ¹ì–´ ê²€ì¦)

## í˜„ì¬ì˜ ìƒíƒœ / ë¬¸ì œì 

### 1. í•˜ë“œì½”ë”©ëœ Tauri ëª…ë ¹ì–´ ì²˜ë¦¬

```typescript
// src/components/MessageRenderer.tsx (í˜„ì¬ ë¬¸ì œ)
switch (strippedCommand) {
  case 'downloadWorkspaceFile': {
    result = await tauriCommands.downloadWorkspaceFile(
      params.filePath as string,
    );
    break;
  }
  case 'exportAndDownloadZip': {
    result = await tauriCommands.exportAndDownloadZip(
      params.files as string[],
      params.packageName as string,
    );
    break;
  }
  // ìƒˆ ëª…ë ¹ì–´ë§ˆë‹¤ ì¼€ì´ìŠ¤ ì¶”ê°€ í•„ìš” - ë°±ì—”ë“œì™€ ê°•í•œ ê²°í•©
}
```

### 2. ê³¼ë„í•œ í•¨ìˆ˜ ë³µì¡ì„±

- `handleUIAction` í•¨ìˆ˜ê°€ 5ê°œ ì´ìƒì˜ ì•¡ì…˜ íƒ€ì… ì²˜ë¦¬
- ë‹¨ì¼ ì±…ì„ ì›ì¹™ ìœ„ë°˜ (SRP violation)
- í…ŒìŠ¤íŠ¸ ë° ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€

### 3. ì¤‘ë³µ ì½”ë“œ íŒ¨í„´

- ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ ì¤‘ë³µ
- `useRustBackend()` ì¤‘ë³µ í˜¸ì¶œ
- Tool call message ìƒì„± ë¡œì§ ë°˜ë³µ

## ì¶”ê°€ ë¶„ì„ ê³¼ì œ

### 1. Rust ë°±ì—”ë“œ ì‹œê·¸ë‹ˆì²˜ í˜¸í™˜ì„± ë¶„ì„

- í˜„ì¬ Tauri ëª…ë ¹ì–´ë“¤ì´ ë‹¨ì¼ ê°ì²´ ì¸ìë¥¼ ë°›ëŠ”ì§€ í™•ì¸
- ë™ì  í˜¸ì¶œì„ ìœ„í•œ íŒŒë¼ë¯¸í„° í‘œì¤€í™” í•„ìš”ì„± í‰ê°€
- `useRustBackend` í›…ì˜ íƒ€ì… ì •ì˜ ê²€í† 

### 2. AI ì„œë¹„ìŠ¤ë³„ ì œì•½ì‚¬í•­ ìƒì„¸ ë¶„ì„

- Rust ë°±ì—”ë“œ íŒŒë¼ë¯¸í„° í‘œì¤€í™” ê²€í†  (ë‹¨ì¼ ê°ì²´ ì¸ì vs ê°œë³„ ì¸ì)
- ë™ì  í˜¸ì¶œ ì‹œ íƒ€ì… ì•ˆì „ì„± í™•ë³´ ë°©ì•ˆ
- í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ë³´ì•ˆ ì •ì±… ìˆ˜ë¦½

## ë³€ê²½ ì´í›„ì˜ ìƒíƒœ / í•´ê²° íŒì • ê¸°ì¤€

### ì„±ê³µ ê¸°ì¤€

1. **í™•ì¥ì„±**: ìƒˆ Tauri ëª…ë ¹ì–´ ì¶”ê°€ ì‹œ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
2. **ì½”ë“œ í’ˆì§ˆ**: í•¨ìˆ˜ë³„ ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜, ì¤‘ë³µ ì½”ë“œ 80% ì´ìƒ ì œê±°
3. **ë³´ì•ˆ**: í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ëª…ë ¹ì–´ ê²€ì¦ìœ¼ë¡œ ë¬´ë‹¨ ì ‘ê·¼ ë°©ì§€
4. **ìœ ì§€ë³´ìˆ˜ì„±**: ë™ì  ì²˜ë¦¬ë¡œ ë°±ì—”ë“œ-í”„ë¡ íŠ¸ì—”ë“œ ê²°í•©ë„ ê°ì†Œ

### ê²€ì¦ ë°©ë²•

- ìƒˆ Tauri ëª…ë ¹ì–´ ì¶”ê°€ ì‹œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸í•˜ë©´ ë™ì‘
- ESLint ê·œì¹™ í†µê³¼ ë° ì½”ë“œ ë³µì¡ë„ ê°œì„ 
- í•˜ë“œì½”ë”©ëœ switchë¬¸ ì™„ì „ ì œê±°

## ìˆ˜ì •ì´ í•„ìš”í•œ ì½”ë“œ ë° ìˆ˜ì •ë¶€ë¶„

### 1. MessageRenderer.tsx í•µì‹¬ ìˆ˜ì •

```typescript
// í˜„ì¬ (ë¬¸ì œìˆëŠ” ì½”ë“œ)
if (toolName.startsWith('tauri:')) {
  const [, strippedCommand] = toolName.split('tauri:');
  // í•˜ë“œì½”ë”©ëœ switchë¬¸ - ë°±ì—”ë“œ ì˜ì¡´ì„±
  switch (strippedCommand) {
    case 'downloadWorkspaceFile':
      /* ... */ break;
    case 'exportAndDownloadZip':
      /* ... */ break;
  }
}

// ê°œì„  í›„ (ë™ì  ì²˜ë¦¬)
if (toolName.startsWith('tauri:')) {
  await handleTauriAction(toolName, params, sessionId, assistantId);
}
```

### 2. ë™ì  Tauri ëª…ë ¹ì–´ ì‹¤í–‰ êµ¬ì¡°

```typescript
// ìƒˆë¡œìš´ handleTauriAction í•¨ìˆ˜
const commandFn = safeTauriCommand(tauriCommands, strippedCommand);
if (commandFn) {
  const result = await commandFn(params); // ë™ì  ì‹¤í–‰
  // plan.md ì œì•ˆ êµ¬í˜„: ê°ì²´ ì¸ìë¡œ í†µì¼ëœ í˜¸ì¶œ
}
```

### 3. Handler ë¶„ë¦¬ë¥¼ í†µí•œ ë³µì¡ë„ ê°ì†Œ

```typescript
// ê¸°ì¡´ (ë³µì¡í•œ ë‹¨ì¼ í•¨ìˆ˜)
const handleUIAction = useCallback(async (result: UIActionResult) => {
  // 300+ ì¤„ì˜ ë³µì¡í•œ ë¡œì§
  switch (result.type) {
    case 'tool': {
      if (toolName.startsWith('tauri:')) {
        // í•˜ë“œì½”ë”©ëœ Tauri ì²˜ë¦¬
        switch (strippedCommand /* ... */) {
        }
      } else {
        // MCP ì²˜ë¦¬
      }
    }
    // ë‹¤ë¥¸ ì¼€ì´ìŠ¤ë“¤...
  }
});

// ê°œì„  í›„ (ë¶„ë¦¬ëœ í•¸ë“¤ëŸ¬)
const handleUIAction = useCallback(async (result: UIActionResult) => {
  switch (result.type) {
    case 'tool':
      if (toolName.startsWith('tauri:')) {
        await handleTauriAction(toolName, params, sessionId, assistantId);
      } else {
        await handleMCPAction(toolName, params, sessionId, assistantId);
      }
      break;
    // ë‹¤ë¥¸ ì¼€ì´ìŠ¤ë“¤ë„ ë¶„ë¦¬ëœ í•¸ë“¤ëŸ¬ë¡œ...
  }
});
```

## ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ê´€ ì½”ë“œ

### ìƒì„±í•  ìœ í‹¸ë¦¬í‹° íŒŒì¼

#### 1. `src/lib/tauri-utils.ts`

```typescript
// ì£¼ìš” ê¸°ëŠ¥: ì•ˆì „í•œ Tauri ëª…ë ¹ì–´ ê²€ì¦ ë° ì‹¤í–‰
export function safeTauriCommand(commands, commandName): Function | null;
export const ALLOWED_TAURI_COMMANDS: Set<string>;
export function isAllowedTauriCommand(commandName: string): boolean;
```

#### 2. `src/lib/chat-utils.ts` (í™•ì¥)

```typescript
// ì£¼ìš” ê¸°ëŠ¥: Tool message ìŒ ìƒì„± (ì´ë¯¸ êµ¬í˜„ë¨)
export const createToolMessagePair: (
  toolName,
  params,
  result,
  toolCallId,
  sessionId,
  assistantId,
  isError?,
) => [Message, Message];
```

### ì—°ê´€ ì¸í„°í˜ì´ìŠ¤

```typescript
// src/models/chat.ts
interface Message {
  tool_calls?: ToolCall[]; // assistant ë©”ì‹œì§€ìš©
  tool_call_id?: string; // tool ë©”ì‹œì§€ìš© (í•„ìˆ˜)
}

// src/lib/mcp-types.ts
interface UIActionResult {
  type: 'tool' | 'intent' | 'prompt' | 'link' | 'notify';
  payload: { toolName: string; params: Record<string, unknown> };
}
```

### ê¸°ì¡´ í™œìš© ì½”ë“œ

- `src/hooks/use-rust-backend.ts`: tauriCommands ê°ì²´ ì œê³µ
- `src/hooks/use-unified-mcp.ts`: executeToolCall í•¨ìˆ˜
- `src/lib/chat-utils.ts`: Tool message ìŒ ìƒì„± í—¬í¼ (ì´ë¯¸ êµ¬í˜„ë¨)
- `src/lib/tauri-utils.ts`: ì•ˆì „í•œ Tauri ëª…ë ¹ì–´ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹° (ì´ë¯¸ êµ¬í˜„ë¨)

## êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë°˜ ìœ í‹¸ë¦¬í‹° êµ¬ì¶• (ì™„ë£Œ)

1. âœ… `tauri-utils.ts` ìƒì„± ë° safeTauriCommand êµ¬í˜„
2. âœ… `chat-utils.ts`ì— createToolMessagePair ì¶”ê°€
3. âœ… í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ë³´ì•ˆ ê²€ì¦ ë¡œì§

### Phase 2: ë™ì  Tauri ì²˜ë¦¬ êµ¬í˜„ (ì§„í–‰ ì¤‘)

1. ğŸ”§ handleTauriAction í•¨ìˆ˜ êµ¬í˜„ ë° ì ìš©
2. ğŸ”§ í•˜ë“œì½”ë”©ëœ switchë¬¸ì„ ë™ì  ì²˜ë¦¬ë¡œ êµì²´
3. ğŸ”§ Rust ë°±ì—”ë“œ íŒŒë¼ë¯¸í„° í˜¸í™˜ì„± ê²€ì¦

### Phase 3: Handler ë¶„ë¦¬ ë° ë¦¬íŒ©í† ë§

1. ğŸ”§ handleMCPAction, handleIntentAction ë“± ë¶„ë¦¬
2. ğŸ”§ handleUIActionì„ ê°„ì†Œí™”ëœ ë¼ìš°í„°ë¡œ ë³€ê²½
3. ğŸ”§ ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ì˜ì¡´ì„± ë°°ì—´ ìˆ˜ì •

### Phase 4: ê²€ì¦ ë° ìµœì í™”

1. ğŸ”§ ìƒˆ Tauri ëª…ë ¹ì–´ ì¶”ê°€ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
2. ğŸ”§ ì„±ëŠ¥ ìµœì í™” ë° ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
3. ğŸ”§ ì½”ë“œ ë³µì¡ë„ ë° ìœ ì§€ë³´ìˆ˜ì„± ê²€ì¦

ì´ ë¦¬íŒ©í† ë§ì„ í†µí•´ MessageRendererëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ê²¬ê³ í•œ êµ¬ì¡°ë¡œ ê°œì„ ë  ê²ƒì´ë‹¤.
