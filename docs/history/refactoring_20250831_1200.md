# Refactoring Plan: SettingsModal UI 개선 및 서비스별 설정 관리

## 작업의 목적

SettingsModal 컴포넌트의 UI를 더 깔끔하고 사용자 친화적으로 개선하며, 서비스별로 다른 설정 요구사항(예: Ollama의 Base URL)을 유연하게 관리할 수 있는 구조로 리팩토링한다. 특히 탭 변경 시 Modal 크기 변화를 방지하고, 설정 입력 UI를 시각적으로 분리하여 가독성을 높인다.

## 현재의 상태 / 문제점

- 서비스별 API Key 입력이 단순히 세로로 나열되어 있어 시각적으로 혼잡함
- Modal 크기가 탭 컨텐츠에 따라 동적으로 변하여 사용자 경험 저하
- 모든 서비스가 동일한 설정 구조(API Key만)를 가정하여, Ollama처럼 추가 설정(Base URL)이 필요한 경우 대응 불가
- 설정 저장 구조가 단순 키-값 형태로, 서비스별 확장성 부족

## 추가 분석 과제 (선택적)

- 지원하는 AI 서비스 목록 및 각 서비스별 필수/선택 설정 항목 조사
- UI 컴포넌트 라이브러리(shadcn/ui) 활용 가능성 및 커스터마이징 범위 확인
- IndexedDB 저장 구조 변경 시 기존 데이터 마이그레이션 전략 수립

## 변경 이후의 상태 / 해결 판정 기준

- Modal 크기가 고정되고, 탭 변경 시 높이 변화 없음
- 서비스별 설정이 카드 형태로 시각적으로 분리됨
- Ollama 등 추가 설정이 필요한 서비스에 대해 Base URL 등 필드 동적 표시
- 설정 저장 구조가 서비스별 객체 형태로 변경되어 확장성 확보
- UI가 반응형으로, 다양한 화면 크기에서 적절히 표시됨

## 수정이 필요한 코드 및 수정부분의 코드 스니핏

### 주요 수정 파일: `src/features/settings/SettingsModal.tsx`

- Modal 내부 컨테이너에 `min-h-[400px] overflow-y-auto` 추가로 크기 고정
- API Key 탭 컨텐츠를 Grid 레이아웃으로 변경: `grid grid-cols-1 md:grid-cols-2 gap-6`
- 각 서비스별 설정을 Card 컴포넌트로 감싸 시각적 분리
- 조건부 렌더링으로 서비스별 추가 필드 표시 (예: Ollama의 Base URL)

### 설정 저장 구조 변경

```typescript
// 변경 전
type Settings = {
  apiKeys: Record<AIServiceProvider, string>;
  windowSize: number;
};

// 변경 후
type ServiceConfig = {
  apiKey?: string;
  baseUrl?: string;
  // 추가 설정 가능
};

type Settings = {
  serviceConfigs: Record<AIServiceProvider, ServiceConfig>;
  windowSize: number;
};
```

### UI 개선 스니핏 예시

```tsx
// 변경 전: 단순 나열
<div className="space-y-6 pt-4">
  {Object.values(AIServiceProvider).map((serviceProvider) => (
    <div key={serviceProvider}>
      <label>API Key</label>
      <Input ... />
    </div>
  ))}
</div>

// 변경 후: 카드 + 그리드 + 조건부 필드
<div className="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
  {Object.entries(serviceConfigs).map(([provider, config]) => (
    <Card key={provider} className="p-4">
      <h3 className="font-medium mb-3">{provider}</h3>
      <div className="space-y-3">
        <div>
          <label>API Key</label>
          <Input value={config.apiKey} ... />
        </div>
        {provider === 'ollama' && (
          <div>
            <label>Base URL</label>
            <Input value={config.baseUrl} ... />
          </div>
        )}
      </div>
    </Card>
  ))}
</div>
```

## 재사용 가능한 연관 코드

- **설정 관리 훅**: `src/hooks/use-settings.ts` - 설정 상태 및 업데이트 로직
- **AI 서비스 타입**: `src/lib/ai-service.ts` - `AIServiceProvider` enum 및 관련 타입
- **UI 컴포넌트**: `src/components/ui/` - Card, Input, Modal, Tabs 등 재사용 컴포넌트
- **저장소**: IndexedDB 관련 로직 (Dexie 사용) - 설정 영속화
- **테마/스타일링**: Tailwind CSS 클래스 및 shadcn/ui 테마 설정
