# MCP Server Context ìƒíƒœ ëª…í™•í™” ë° UI ë¡œë”© í‘œì‹œ ê°œì„  ë¦¬íŒ©í„°ë§

## ì‘ì—…ì˜ ëª©ì 

MCP Server Contextì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ëª…í™•í•˜ê²Œ í•˜ê³ , Chat.tsxì—ì„œ ë„êµ¬ ê°œìˆ˜ í‘œì‹œ ì‹œ ë¡œë”© ìƒíƒœë¥¼ ì ì ˆíˆ í‘œì‹œí•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

## í˜„ì¬ì˜ ìƒíƒœ / ë¬¸ì œì 

### 1. MCPServerContext ìƒíƒœ ì´ë¦„ì˜ ëª¨í˜¸í•¨

**ìœ„ì¹˜**: `src/context/MCPServerContext.tsx`

- **ë¬¸ì œ**: `isConnecting` ì´ë¦„ì´ ëª¨í˜¸í•˜ì—¬ ì´ˆê¸°í™”/ì—°ê²°/ë¡œë”© ìƒíƒœë¥¼ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ì›€
- **ì˜í–¥**: ê°œë°œìê°€ ìƒíƒœì˜ ì˜ë¯¸ë¥¼ íŒŒì•…í•˜ê¸° ì–´ë µê³ , ì¼ë°˜ì ì¸ React íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ

**í˜„ì¬ ì½”ë“œ**:

```typescript
interface MCPServerContextType {
  availableTools: MCPTool[];
  getAvailableTools: () => MCPTool[];
  isConnecting: boolean; // ëª¨í˜¸í•œ ì´ë¦„
  status: Record<string, boolean>;
  connectServers: (mcpConfigs: MCPConfig) => Promise<void>;
  executeToolCall: (toolCall: {...}) => Promise<MCPResponse>;
}
```

### 2. ì—ëŸ¬ ìƒíƒœ ëˆ„ë½

**ìœ„ì¹˜**: `src/context/MCPServerContext.tsx`

- **ë¬¸ì œ**: MCP ì„œë²„ ì—°ê²° ì‹¤íŒ¨ë‚˜ ë„êµ¬ ì‹¤í–‰ ì—ëŸ¬ì— ëŒ€í•œ ì „ì—­ ìƒíƒœê°€ ì—†ìŒ
- **ì˜í–¥**: ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ìƒí™©ì„ ì•Œë¦´ ìˆ˜ ì—†ê³ , UIì—ì„œ ì ì ˆí•œ í”¼ë“œë°±ì„ ì œê³µí•  ìˆ˜ ì—†ìŒ

**í˜„ì¬ ì½”ë“œ**:

```typescript
const [{ loading: isConnecting }, connectServers] = useAsyncFn(
  async (mcpConfig: MCPConfig) => {
    // ...
    try {
      // connection logic
    } catch (error) {
      logger.error('Error connecting to MCP:', { error });
      // ì—ëŸ¬ ìƒíƒœë¥¼ contextì— ì €ì¥í•˜ì§€ ì•ŠìŒ
    }
  },
  [],
);
```

### 3. Chat.tsxì—ì„œ ë¶ˆëª…í™•í•œ ë„êµ¬ ìƒíƒœ í‘œì‹œ

**ìœ„ì¹˜**: `src/features/chat/Chat.tsx`

- **ë¬¸ì œ**: ë„êµ¬ ê°œìˆ˜ë§Œ í‘œì‹œí•˜ê³  ë¡œë”©/ì—ëŸ¬ ìƒíƒœì— ëŒ€í•œ ì ì ˆí•œ í”¼ë“œë°±ì´ ì—†ìŒ
- **ì˜í–¥**: ì‚¬ìš©ìê°€ MCP ì„œë²„ ì—°ê²° ìƒíƒœë¥¼ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€

**í˜„ì¬ ì½”ë“œ**:

```typescript
function ChatStatusBar({ children, onShowTools }: { ... }) {
  const { availableTools: mcpTools } = useMCPServer();
  const availableTools = useMemo(() => [...mcpTools], [mcpTools]);

  return (
    <div className="px-4 py-2 border-t flex items-center justify-between">
      {/* ... */}
      <button onClick={onShowTools}>
        ğŸ”§ {availableTools.length} available
      </button>
    </div>
  );
}
```

### 4. useMCPServer í›…ì˜ íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±

**ìœ„ì¹˜**: `src/hooks/use-mcp-server.ts`

- **ë¬¸ì œ**: ë°˜í™˜ íƒ€ì…ì´ ëª…ì‹œë˜ì§€ ì•Šì•„ íƒ€ì… ì¶”ë¡ ì— ì˜ì¡´
- **ì˜í–¥**: IDE ì§€ì›ì´ ì œí•œë˜ê³ , íƒ€ì… ì•ˆì „ì„±ì´ ë³´ì¥ë˜ì§€ ì•ŠìŒ

**í˜„ì¬ ì½”ë“œ**:

```typescript
export const useMCPServer = () => {
  const context = useContext(MCPServerContext);
  if (context === undefined) {
    throw new Error('useMCPServer must be used within a MCPServerProvider');
  }
  return context; // íƒ€ì…ì´ ëª…ì‹œë˜ì§€ ì•ŠìŒ
};
```

## ë³€ê²½ ì´í›„ì˜ ìƒíƒœ / í•´ê²° íŒì • ê¸°ì¤€

### 1. ëª…í™•í•œ ìƒíƒœ ì´ë¦„ ë° ì—ëŸ¬ ìƒíƒœ ì¶”ê°€

- **í•´ê²°ì±…**: `isConnecting` â†’ `isLoading`ìœ¼ë¡œ ë³€ê²½í•˜ê³  `error?: string` ìƒíƒœ ì¶”ê°€
- **íŒì • ê¸°ì¤€**:
  - Context ì¸í„°í˜ì´ìŠ¤ì— `isLoading`ê³¼ `error` í•„ë“œê°€ ìˆì–´ì•¼ í•¨
  - ì—°ê²° ì‹¤íŒ¨ ì‹œ `error` ìƒíƒœê°€ ì ì ˆíˆ ì„¤ì •ë˜ì–´ì•¼ í•¨

### 2. ì‚¬ìš©ì ì¹œí™”ì ì¸ ë„êµ¬ ìƒíƒœ í‘œì‹œ

- **í•´ê²°ì±…**: ë¡œë”©/ì—ëŸ¬/ì„±ê³µ ìƒíƒœì— ë”°ë¥¸ ì ì ˆí•œ í…ìŠ¤íŠ¸, ìƒ‰ìƒ ë° ë¡œë”© ì•„ì´ì½˜ í‘œì‹œ
- **íŒì • ê¸°ì¤€**:
  - ë¡œë”© ì¤‘: ìŠ¤í”¼ë„ˆ ì•„ì´ì½˜ê³¼ "Loading tools..." í‘œì‹œ (ë…¸ë€ìƒ‰)
  - ì—ëŸ¬ ë°œìƒ: "Tools error" í‘œì‹œ (ë¹¨ê°„ìƒ‰)
  - ì •ìƒ ìƒíƒœ: "X available" í‘œì‹œ (ì´ˆë¡ìƒ‰)
  - ë¡œë”© ì¤‘ì—ëŠ” ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì–´ì•¼ í•¨
  - ë¡œë”© ì•„ì´ì½˜ì€ ë¶€ë“œëŸ¬ìš´ íšŒì „ ì• ë‹ˆë©”ì´ì…˜ì´ ìˆì–´ì•¼ í•¨

### 3. íƒ€ì… ì•ˆì „ì„± í™•ë³´

- **í•´ê²°ì±…**: useMCPServer í›…ì— ëª…ì‹œì  ë°˜í™˜ íƒ€ì… ì§€ì •
- **íŒì • ê¸°ì¤€**:
  - í›…ì˜ ë°˜í™˜ íƒ€ì…ì´ `MCPServerContextType`ìœ¼ë¡œ ëª…ì‹œë˜ì–´ì•¼ í•¨
  - TypeScript ì»´íŒŒì¼ ì—ëŸ¬ê°€ ì—†ì–´ì•¼ í•¨

## ìˆ˜ì •ì´ í•„ìš”í•œ ì½”ë“œ ë° ìˆ˜ì •ë¶€ë¶„ì˜ ì½”ë“œ ìŠ¤ë‹ˆí«

### ìˆ˜ì • 1: MCPServerContext ì¸í„°í˜ì´ìŠ¤ ê°œì„ 

**íŒŒì¼**: `src/context/MCPServerContext.tsx`

```typescript
// í˜„ì¬
interface MCPServerContextType {
  availableTools: MCPTool[];
  getAvailableTools: () => MCPTool[];
  isConnecting: boolean;
  status: Record<string, boolean>;
  connectServers: (mcpConfigs: MCPConfig) => Promise<void>;
  executeToolCall: (toolCall: {
    id: string;
    type: 'function';
    function: { name: string; arguments: string };
  }) => Promise<MCPResponse>;
}

// ìˆ˜ì • í›„
interface MCPServerContextType {
  availableTools: MCPTool[];
  getAvailableTools: () => MCPTool[];
  isLoading: boolean;     // isConnectingì—ì„œ ë³€ê²½
  error?: string;         // ì—ëŸ¬ ìƒíƒœ ì¶”ê°€
  status: Record<string, boolean>;
  connectServers: (mcpConfigs: MCPConfig) => Promise<void>;
  executeToolCall: (toolCall: {
    id: string;
    type: 'function';
    function: { name: string; arguments: string };
  }) => Promise<MCPResponse>;
}
```

### ìˆ˜ì • 2: MCPServerProviderì—ì„œ ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬

**íŒŒì¼**: `src/context/MCPServerContext.tsx`

```typescript
// í˜„ì¬
export const MCPServerProvider: React.FC<{ children: ReactNode }> = ({
  children,
}) => {
  const [availableTools, setAvailableTools] = useState<MCPTool[]>([]);
  const [serverStatus, setServerStatus] = useState<Record<string, boolean>>({});
  const availableToolsRef = useRef(availableTools);

  const [{ loading: isConnecting }, connectServers] = useAsyncFn(
    async (mcpConfig: MCPConfig) => {
      const serverStatus: Record<string, boolean> = {};
      try {
        // connection logic
      } catch (error) {
        logger.error('Error connecting to MCP:', { error });
      }
    },
    [],
  );

// ìˆ˜ì • í›„
export const MCPServerProvider: React.FC<{ children: ReactNode }> = ({
  children,
}) => {
  const [availableTools, setAvailableTools] = useState<MCPTool[]>([]);
  const [serverStatus, setServerStatus] = useState<Record<string, boolean>>({});
  const [error, setError] = useState<string | undefined>(undefined); // ì—ëŸ¬ ìƒíƒœ ì¶”ê°€
  const availableToolsRef = useRef(availableTools);

  const [{ loading: isLoading }, connectServers] = useAsyncFn(
    async (mcpConfig: MCPConfig) => {
      const serverStatus: Record<string, boolean> = {};
      setError(undefined); // ì—°ê²° ì‹œì‘ ì‹œ ì—ëŸ¬ ì´ˆê¸°í™”
      try {
        // connection logic
      } catch (error) {
        const errorMessage = error instanceof Error ? error.message : String(error);
        setError(errorMessage); // ì—ëŸ¬ ìƒíƒœ ì„¤ì •
        logger.error('Error connecting to MCP:', { error });
      }
    },
    [],
  );
```

### ìˆ˜ì • 3: Context valueì— ìƒˆ ìƒíƒœ í¬í•¨

**íŒŒì¼**: `src/context/MCPServerContext.tsx`

```typescript
// í˜„ì¬
  const value: MCPServerContextType = useMemo(
    () => ({
      availableTools,
      isConnecting,
      getAvailableTools,
      status: serverStatus,
      connectServers,
      executeToolCall,
    }),
    [
      availableTools,
      isConnecting,
      serverStatus,
      getAvailableTools,
      connectServers,
      executeToolCall,
    ],
  );

// ìˆ˜ì • í›„
  const value: MCPServerContextType = useMemo(
    () => ({
      availableTools,
      isLoading,      // isConnectingì—ì„œ ë³€ê²½
      error,          // ì—ëŸ¬ ìƒíƒœ ì¶”ê°€
      getAvailableTools,
      status: serverStatus,
      connectServers,
      executeToolCall,
    }),
    [
      availableTools,
      isLoading,      // ë³€ê²½ëœ ì´ë¦„
      error,          // ì—ëŸ¬ ìƒíƒœ ì¶”ê°€
      serverStatus,
      getAvailableTools,
      connectServers,
      executeToolCall,
    ],
  );
```

### ìˆ˜ì • 4: ChatStatusBar ì»´í¬ë„ŒíŠ¸ ê°œì„ 

**íŒŒì¼**: `src/features/chat/Chat.tsx`

```typescript
// í˜„ì¬
function ChatStatusBar({
  children,
  onShowTools,
}: {
  children?: React.ReactNode;
  onShowTools?: () => void;
}) {
  const { availableTools: mcpTools } = useMCPServer();
  const availableTools = useMemo(() => [...mcpTools], [mcpTools]);

  return (
    <div className="px-4 py-2 border-t flex items-center justify-between">
      <div>
        <CompactModelPicker />
        {children}
      </div>
      <div className="flex items-center gap-2">
        <span className="text-xs">Tools:</span>
        <button
          onClick={onShowTools}
          className="text-xs text-green-400 transition-colors flex items-center gap-1"
        >
          ğŸ”§ {availableTools.length} available
        </button>
      </div>
    </div>
  );
}

// ìˆ˜ì • í›„
function ChatStatusBar({
  children,
  onShowTools,
}: {
  children?: React.ReactNode;
  onShowTools?: () => void;
}) {
  const { availableTools, isLoading, error } = useMCPServer();

  // ë¡œë”© ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸
  const LoadingSpinner = () => (
    <svg 
      className="animate-spin h-3 w-3 text-yellow-400" 
      xmlns="http://www.w3.org/2000/svg" 
      fill="none" 
      viewBox="0 0 24 24"
    >
      <circle 
        className="opacity-25" 
        cx="12" 
        cy="12" 
        r="10" 
        stroke="currentColor" 
        strokeWidth="4"
      />
      <path 
        className="opacity-75" 
        fill="currentColor" 
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      />
    </svg>
  );

  // ë„êµ¬ ìƒíƒœë¥¼ ê³„ì‚°
  const getToolsDisplayText = () => {
    if (isLoading) return 'Loading tools...';
    if (error) return 'Tools error';
    return `${availableTools.length} available`;
  };

  const getToolsColor = () => {
    if (isLoading) return 'text-yellow-400';
    if (error) return 'text-red-400'; 
    return availableTools.length > 0 ? 'text-green-400' : 'text-gray-500';
  };

  const getToolsIcon = () => {
    if (isLoading) return <LoadingSpinner />;
    if (error) return 'âš ï¸';
    return 'ğŸ”§';
  };

  return (
    <div className="px-4 py-2 border-t flex items-center justify-between">
      <div>
        <CompactModelPicker />
        {children}
      </div>
      <div className="flex items-center gap-2">
        <span className="text-xs">Tools:</span>
        <button
          onClick={onShowTools}
          className={`text-xs transition-colors flex items-center gap-1 ${getToolsColor()}`}
          disabled={isLoading}
          title={error || undefined}
        >
          {getToolsIcon()} {getToolsDisplayText()}
        </button>
      </div>
    </div>
  );
}
```

### ìˆ˜ì • 5: useMCPServer í›… íƒ€ì… ì•ˆì „ì„± ê°œì„ 

**íŒŒì¼**: `src/hooks/use-mcp-server.ts`

```typescript
// í˜„ì¬
export const useMCPServer = () => {
  const context = useContext(MCPServerContext);
  if (context === undefined) {
    throw new Error('useMCPServer must be used within a MCPServerProvider');
  }
  return context;
};

// ìˆ˜ì • í›„
import type { MCPServerContextType } from '../context/MCPServerContext';

export const useMCPServer = (): MCPServerContextType => {
  const context = useContext(MCPServerContext);
  if (context === undefined) {
    throw new Error('useMCPServer must be used within a MCPServerProvider');
  }
  return context;
};
```

## ì‘ì—… ìš°ì„ ìˆœìœ„

1. **High**: MCPServerContext ì¸í„°í˜ì´ìŠ¤ ë° Provider ìˆ˜ì • (ìƒíƒœ ê´€ë¦¬ ê¸°ë°˜)
2. **High**: useMCPServer í›… íƒ€ì… ì•ˆì „ì„± ê°œì„  (íƒ€ì… ì—ëŸ¬ ë°©ì§€)
3. **Medium**: ChatStatusBar UI ê°œì„  (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)

## ì˜ˆìƒ ì˜í–¥ë„

- **Breaking Change**: ì—†ìŒ (`isConnecting` â†’ `isLoading` ë³€ê²½ì€ ë‚´ë¶€ êµ¬í˜„)
- **ì‚¬ìš©ì ê²½í—˜**: ëª…í™•í•œ ë¡œë”©/ì—ëŸ¬ ìƒíƒœ í‘œì‹œë¡œ í¬ê²Œ ê°œì„ 
- **ê°œë°œì ê²½í—˜**: íƒ€ì… ì•ˆì „ì„± í–¥ìƒìœ¼ë¡œ ê°œë°œ íš¨ìœ¨ì„± ì¦ëŒ€
- **Testing Required**:
  - MCP ì„œë²„ ì—°ê²° ì„±ê³µ/ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
  - UI ìƒíƒœ ë³€í™” í…ŒìŠ¤íŠ¸ (ë¡œë”© â†’ ì„±ê³µ/ì—ëŸ¬)
  - íƒ€ì… ì•ˆì „ì„± ê²€ì¦

## ê²€ì¦ ë°©ë²•

1. **ê¸°ëŠ¥ ê²€ì¦**:
   - MCP ì„œë²„ ì—°ê²° ì¤‘ ìŠ¤í”¼ë„ˆ ì•„ì´ì½˜ê³¼ "Loading tools..." í‘œì‹œ í™•ì¸
   - ìŠ¤í”¼ë„ˆê°€ ë¶€ë“œëŸ½ê²Œ íšŒì „í•˜ëŠ”ì§€ í™•ì¸
   - ì—°ê²° ì‹¤íŒ¨ ì‹œ "Tools error" í‘œì‹œ ë° ê²½ê³  ì•„ì´ì½˜(âš ï¸), ë¹¨ê°„ìƒ‰ í‘œì‹œ í™•ì¸
   - ì •ìƒ ì—°ê²° ì‹œ ë„êµ¬ ê°œìˆ˜ì™€ ğŸ”§ ì•„ì´ì½˜, ì´ˆë¡ìƒ‰ í‘œì‹œ í™•ì¸

2. **íƒ€ì… ê²€ì¦**:
   - TypeScript ì»´íŒŒì¼ ì—ëŸ¬ ì—†ìŒ í™•ì¸
   - IDEì—ì„œ ìë™ì™„ì„± ë° íƒ€ì… íŒíŠ¸ ì •ìƒ ì‘ë™ í™•ì¸

3. **ì‚¬ìš©ì„± ê²€ì¦**:
   - ë¡œë”© ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™” í™•ì¸
   - ì—ëŸ¬ ìƒíƒœì—ì„œ íˆ´íŒìœ¼ë¡œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í™•ì¸
   - ë¡œë”© ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ì´ ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ì§€ í™•ì¸
