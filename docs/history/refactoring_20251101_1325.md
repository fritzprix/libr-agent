# Chat UI/UX ê°œì„ : Width Overflow ë° Rich Display ë¦¬íŒ©í† ë§ ê³„íš

## ğŸ“… ì‘ì„± ì¼ì‹œ

2025ë…„ 11ì›” 1ì¼ 13:25

## ğŸ¯ ì‘ì—…ì˜ ëª©ì 

Chat UIì˜ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ë‹¬ì„±:

1. Agent ì‘ë‹µì—ì„œ width overflow ë°œìƒ ì‹œ ì ì ˆí•œ ìŠ¤í¬ë¡¤ ì œê³µ
2. Agent ë©”ì‹œì§€ë¥¼ Richí•˜ê²Œ í‘œì‹œ (ChatGPT ìŠ¤íƒ€ì¼ì˜ ì „ì²´ ë„ˆë¹„ í™œìš©)
3. ì½”ë“œ ë¸”ë¡ì— Syntax Highlighting ì¶”ê°€
4. Streaming ì¤‘ ë” ë‚˜ì€ Loading UI ì œê³µ
5. User ë©”ì‹œì§€ëŠ” ê°„ê²°í•œ ë²„ë¸”, AgentëŠ” Embedded í˜•íƒœë¡œ ì°¨ë³„í™”

**í•µì‹¬ ëª©í‘œ**: idea.mdì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ë©´ì„œ overflow ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ê°€ë…ì„±ì„ í–¥ìƒ

## ğŸ” í˜„ì¬ì˜ ìƒíƒœ / ë¬¸ì œì 

### 1. Width Overflow ë¬¸ì œ

- **ReactMarkdown ì»´í¬ë„ŒíŠ¸**: `pre`, `code` íƒœê·¸ì— overflow ì²˜ë¦¬ ìŠ¤íƒ€ì¼ì´ ì—†ìŒ
  - ê¸´ ì½”ë“œ ë¼ì¸ì´ ë²„ë¸” ë°–ìœ¼ë¡œ ë„˜ì¹¨
  - ìˆ˜í‰ ìŠ¤í¬ë¡¤ ì—†ìŒ
  - `MessageRenderer.tsx` lines 402-418
- **ì „ì—­ CSS**: `globals.css`ì— markdown ê´€ë ¨ ìŠ¤íƒ€ì¼ ì •ì˜ ì—†ìŒ

### 2. ë©”ì‹œì§€ ë ˆì´ì•„ì›ƒ ì œì•½

- **ëª¨ë“  ë©”ì‹œì§€ ì—­í• ì— ë™ì¼í•œ ë„ˆë¹„ ì œí•œ** (`MessageBubble.tsx` line 74)

  ```tsx
  max-w-[85%] lg:max-w-4xl
  ```

  - User ë©”ì‹œì§€ë„, Agent ë©”ì‹œì§€ë„ ë™ì¼í•œ ì œì•½
  - idea.md ìš”êµ¬ì‚¬í•­: AgentëŠ” ì „ì²´ ë„ˆë¹„ í™œìš© í•„ìš”

### 3. Syntax Highlighting ë¶€ì¬

- í˜„ì¬ ReactMarkdownë§Œ ì‚¬ìš©, syntax highlighting ì—†ìŒ
- ì½”ë“œ ë¸”ë¡ì´ ë‹¨ìˆœ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë˜ì–´ ê°€ë…ì„± ì €í•˜

### 4. ë‹¨ì¡°ë¡œìš´ Loading UI

- `ChatMessages.tsx` lines 86-95: ë‹¨ìˆœ "thinking..." í…ìŠ¤íŠ¸
- ì• ë‹ˆë©”ì´ì…˜ì´ë‚˜ ë™ì  íš¨ê³¼ ì—†ìŒ

## ğŸ—ï¸ ê´€ë ¨ ì½”ë“œ êµ¬ì¡° ë° ë™ì‘ ë°©ì‹ (Bird's Eye View)

### ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡°

```text
Chat (Provider)
â””â”€ ChatMessages (ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ: overflow-y-auto)
    â””â”€ MessageBubble (max-w-[85%] ì œì•½)
        â”œâ”€ Header (ì•„ë°”íƒ€, ì—­í• , íƒ€ì„ìŠ¤íƒ¬í”„)
        â”œâ”€ Attachments (íŒŒì¼ ëª©ë¡)
        â”œâ”€ Thinking (ìŠ¤íŠ¸ë¦¬ë° ìƒíƒœ)
        â””â”€ MessageBubbleRouter
            â”œâ”€ ContentBubble â†’ MessageRenderer
            â”‚   â””â”€ ReactMarkdown (í…ìŠ¤íŠ¸)
            â”‚       â”œâ”€ p, code, pre (ìŠ¤íƒ€ì¼ ì—†ìŒ)
            â”‚       â””â”€ ...
            â”‚   â””â”€ UIResourceRenderer (ë¦¬ì†ŒìŠ¤)
            â”œâ”€ ToolCallBubble (BaseBubble)
            â””â”€ ToolOutputBubble (BaseBubble)
```

### ë°ì´í„° í”Œë¡œìš°

1. `ChatContext` â†’ `ChatMessages` â†’ messages ë°°ì—´
2. ê° message â†’ `MessageBubble` (ì—­í• ë³„ ìŠ¤íƒ€ì¼ ê²°ì •)
3. message.content (MCPContent[]) â†’ `MessageRenderer`
4. Text content â†’ `ReactMarkdown` ë Œë”ë§
5. Resource content â†’ `UIResourceRenderer`

### Width ì œí•œ ì§€ì 

1. **MessageBubble**: `max-w-[85%] lg:max-w-4xl` (ëª¨ë“  ì—­í•  ê³µí†µ)
2. **BaseBubble**: `max-h-96 overflow-auto` (ìˆ˜ì§ ìŠ¤í¬ë¡¤ë§Œ)
3. **ReactMarkdown**: ìŠ¤íƒ€ì¼ ì—†ìŒ (overflow ì²˜ë¦¬ ì•ˆë¨)

## âœ¨ ë³€ê²½ ì´í›„ì˜ ìƒíƒœ / í•´ê²° íŒì • ê¸°ì¤€

### ì„±ê³µ ê¸°ì¤€

1. âœ… ê¸´ ì½”ë“œ ë¸”ë¡ì´ ìˆ˜í‰ ìŠ¤í¬ë¡¤ë¡œ ì²˜ë¦¬ë¨ (ë²„ë¸” ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•ŠìŒ)
2. âœ… Agent ë©”ì‹œì§€ê°€ ì „ì²´ ë„ˆë¹„ í™œìš© (UserëŠ” ê¸°ì¡´ ë²„ë¸” ìœ ì§€)
3. âœ… ì½”ë“œ ë¸”ë¡ì— syntax highlighting ì ìš©
4. âœ… Loading UIê°€ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ì™€ í•¨ê»˜ í‘œì‹œ
5. âœ… ê¸´ í…ìŠ¤íŠ¸ ë¼ì¸ì´ ìë™ ì¤„ë°”ê¿ˆë¨
6. âœ… ê¸°ì¡´ UI Resource (remoteDom, rawHtml) ì •ìƒ ì‘ë™

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

- [ ] 100ì ì´ìƒì˜ ê¸´ ì½”ë“œ ë¼ì¸ ì…ë ¥ ì‹œ ìˆ˜í‰ ìŠ¤í¬ë¡¤ í™•ì¸
- [ ] Agent ë©”ì‹œì§€ê°€ ì±„íŒ… ì°½ ì „ì²´ ë„ˆë¹„ ì‚¬ìš© í™•ì¸
- [ ] User ë©”ì‹œì§€ê°€ ì—¬ì „íˆ ë²„ë¸” í˜•íƒœ ìœ ì§€ í™•ì¸
- [ ] Python, JavaScript, TypeScript ì½”ë“œ ë¸”ë¡ syntax highlighting í™•ì¸
- [ ] Streaming ì¤‘ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ í™•ì¸
- [ ] Tool Outputì˜ UI Resource ì •ìƒ í‘œì‹œ í™•ì¸

## ğŸ”§ ìˆ˜ì •ì´ í•„ìš”í•œ ì½”ë“œ ë° ì½”ë“œ ìŠ¤ë‹ˆí•

### 1. MessageRenderer.tsx - Code Block Overflow ì²˜ë¦¬

**íŒŒì¼**: `src/components/MessageRenderer.tsx`
**ìœ„ì¹˜**: lines 402-418

**í˜„ì¬ ì½”ë“œ**:

```tsx
<ReactMarkdown
  skipHtml={false}
  remarkPlugins={[]}
  rehypePlugins={[]}
  components={{
    p: ({ children, ...props }) => <p {...props}>{children}</p>,
    code: ({ children, className }) => (
      <code className={className}>{children}</code>
    ),
    pre: ({ children, ...props }) => <pre {...props}>{children}</pre>,
  }}
>
  {textItem.text}
</ReactMarkdown>
```

**ìˆ˜ì • í›„ ì½”ë“œ**:

```tsx
<ReactMarkdown
  skipHtml={false}
  remarkPlugins={[]}
  rehypePlugins={[]}
  components={{
    p: ({ children, ...props }) => (
      <p className="mb-2 last:mb-0" {...props}>
        {children}
      </p>
    ),
    code: ({ inline, children, className, ...props }) => {
      // inline code vs block code êµ¬ë¶„
      if (inline) {
        return (
          <code
            className="px-1.5 py-0.5 bg-muted rounded text-sm font-mono border border-border"
            {...props}
          >
            {children}
          </code>
        );
      }
      // block code (pre > code êµ¬ì¡°ì—ì„œ ì‚¬ìš©ë¨)
      return (
        <code className={`${className} block font-mono text-sm`} {...props}>
          {children}
        </code>
      );
    },
    pre: ({ children, ...props }) => (
      <pre
        className="overflow-x-auto bg-muted rounded-lg p-4 my-3 border border-border max-w-full"
        {...props}
      >
        {children}
      </pre>
    ),
    // ì¶”ê°€: ê¸°íƒ€ ë§ˆí¬ë‹¤ìš´ ìš”ì†Œ
    h1: ({ children, ...props }) => (
      <h1 className="text-2xl font-bold mb-3 mt-4" {...props}>
        {children}
      </h1>
    ),
    h2: ({ children, ...props }) => (
      <h2 className="text-xl font-bold mb-2 mt-3" {...props}>
        {children}
      </h2>
    ),
    h3: ({ children, ...props }) => (
      <h3 className="text-lg font-semibold mb-2 mt-2" {...props}>
        {children}
      </h3>
    ),
    ul: ({ children, ...props }) => (
      <ul className="list-disc list-inside mb-2 space-y-1" {...props}>
        {children}
      </ul>
    ),
    ol: ({ children, ...props }) => (
      <ol className="list-decimal list-inside mb-2 space-y-1" {...props}>
        {children}
      </ol>
    ),
    li: ({ children, ...props }) => (
      <li className="ml-2" {...props}>
        {children}
      </li>
    ),
    blockquote: ({ children, ...props }) => (
      <blockquote
        className="border-l-4 border-primary pl-4 italic my-2 text-muted-foreground"
        {...props}
      >
        {children}
      </blockquote>
    ),
    a: ({ children, href, ...props }) => (
      <a
        href={href}
        className="text-primary hover:underline"
        target="_blank"
        rel="noopener noreferrer"
        {...props}
      >
        {children}
      </a>
    ),
  }}
>
  {textItem.text}
</ReactMarkdown>
```

**ì™¸ë¶€ ì»¨í…Œì´ë„ˆì—ë„ overflow ë³´í˜¸ ì¶”ê°€** (line 385):

```tsx
<div key={key} className="group relative text-sm leading-relaxed overflow-x-hidden break-words">
```

### 2. MessageBubble.tsx - ì—­í• ë³„ ì°¨ë³„í™”ëœ ë ˆì´ì•„ì›ƒ

**íŒŒì¼**: `src/features/chat/MessageBubble.tsx`
**ìœ„ì¹˜**: lines 24-73

**ìˆ˜ì • ì „ëµ**:

- User ë©”ì‹œì§€: ê¸°ì¡´ ë²„ë¸” ìŠ¤íƒ€ì¼ ìœ ì§€ (`max-w-[85%]`)
- Agent/Tool ë©”ì‹œì§€: ì „ì²´ ë„ˆë¹„ í™œìš©, ë²„ë¸” ìŠ¤íƒ€ì¼ ìµœì†Œí™”

**í˜„ì¬ ì½”ë“œ** (line 74):

```tsx
<div
  className={`flex ${styles.container} mb-8 mt-3 animate-in fade-in slide-in-from-bottom-4 duration-500`}
>
  <div
    className={`max-w-[85%] lg:max-w-4xl ${styles.bubble} rounded-2xl px-5 py-4 backdrop-blur-sm transition-all duration-200 hover:shadow-xl`}
  >
```

**ìˆ˜ì • í›„ ì½”ë“œ**:

```tsx
<div
  className={`flex ${styles.container} mb-8 mt-3 animate-in fade-in slide-in-from-bottom-4 duration-500`}
>
  <div
    className={`${getBubbleContainerStyles()} ${styles.bubble} ${getBubblePaddingStyles()} backdrop-blur-sm transition-all duration-200 hover:shadow-xl`}
  >
```

**ì¶”ê°€ í•¨ìˆ˜**:

```tsx
const getBubbleContainerStyles = () => {
  if (isUser) {
    // User: ê°„ê²°í•œ ë²„ë¸”
    return 'max-w-[85%] lg:max-w-4xl rounded-2xl';
  } else if (isAssistant) {
    // Agent: ì „ì²´ ë„ˆë¹„, ìµœì†Œ ë²„ë¸” ìŠ¤íƒ€ì¼
    return 'w-full max-w-full rounded-lg border-l-4';
  } else {
    // Tool: ì¤‘ê°„ í¬ê¸°
    return 'max-w-[90%] lg:max-w-5xl rounded-lg';
  }
};

const getBubblePaddingStyles = () => {
  if (isUser) {
    return 'px-5 py-4';
  } else if (isAssistant) {
    return 'px-6 py-5'; // AgentëŠ” ë” ë„“ì€ íŒ¨ë”©
  } else {
    return 'px-4 py-3';
  }
};
```

### 3. ChatMessages.tsx - Loading UI ê°œì„ 

**íŒŒì¼**: `src/features/chat/components/ChatMessages.tsx`
**ìœ„ì¹˜**: lines 86-95

**í˜„ì¬ ì½”ë“œ**:

```tsx
{
  isLoading && (
    <div className="flex justify-start">
      <div className="rounded px-3 py-2">
        <div className="text-xs mb-1">
          Agent ({currentSession?.assistants[0]?.name})
        </div>
        <div className="text-sm">thinking...</div>
      </div>
    </div>
  );
}
```

**ìˆ˜ì • í›„ ì½”ë“œ**:

```tsx
{
  isLoading && (
    <div className="flex justify-start mb-8 mt-3">
      <div className="w-full max-w-full bg-secondary/30 border-l-4 border-primary rounded-lg px-6 py-5">
        <div className="flex items-center gap-3 mb-2">
          <div className="w-7 h-7 bg-primary rounded-full flex items-center justify-center animate-pulse">
            <Bot size={16} className="text-primary-foreground" />
          </div>
          <span className="text-xs font-medium">
            Agent ({currentSession?.assistants[0]?.name})
          </span>
        </div>
        <div className="flex items-center gap-2 text-sm text-muted-foreground">
          <div className="flex gap-1">
            <span className="animate-bounce" style={{ animationDelay: '0ms' }}>
              â—
            </span>
            <span
              className="animate-bounce"
              style={{ animationDelay: '150ms' }}
            >
              â—
            </span>
            <span
              className="animate-bounce"
              style={{ animationDelay: '300ms' }}
            >
              â—
            </span>
          </div>
          <span className="animate-pulse">Thinking and analyzing...</span>
        </div>
      </div>
    </div>
  );
}
```

### 4. Syntax Highlighting ì¶”ê°€ (Optional Enhancement)

**ìƒˆ ì˜ì¡´ì„± ì¶”ê°€**:

```bash
pnpm add react-syntax-highlighter @types/react-syntax-highlighter
```

**MessageRenderer.tsxì— í†µí•©**:

```tsx
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { oneDark, oneLight } from 'react-syntax-highlighter/dist/esm/styles/prism';

// í…Œë§ˆ ê°ì§€
const isDark = typeof window !== 'undefined' &&
  window.matchMedia('(prefers-color-scheme: dark)').matches;

// ReactMarkdown components ìˆ˜ì •
code: ({ inline, children, className, ...props }) => {
  if (inline) {
    return (
      <code className="px-1.5 py-0.5 bg-muted rounded text-sm font-mono border border-border">
        {children}
      </code>
    );
  }

  // language ì¶”ì¶œ (ì˜ˆ: language-python)
  const match = /language-(\w+)/.exec(className || '');
  const language = match ? match[1] : 'text';

  return (
    <SyntaxHighlighter
      style={isDark ? oneDark : oneLight}
      language={language}
      PreTag="div"
      className="rounded-lg my-3 text-sm"
      customStyle={{
        margin: 0,
        borderRadius: '0.5rem',
        maxWidth: '100%',
      }}
      codeTagProps={{
        className: 'text-sm',
      }}
    >
      {String(children).replace(/\n$/, '')}
    </SyntaxHighlighter>
  );
},
pre: ({ children }) => <>{children}</>, // SyntaxHighlighterê°€ wrapper ì œê³µ
```

## ğŸ”— ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ê´€ ì½”ë“œ

### 1. BaseBubble ì»´í¬ë„ŒíŠ¸

**íŒŒì¼**: `src/components/ui/BaseBubble.tsx`

- **ì£¼ìš” ê¸°ëŠ¥**: Collapsible ë²„ë¸” UI (Tool Call/Outputì— ì‚¬ìš©)
- **ì¸í„°í˜ì´ìŠ¤**:
  ```tsx
  interface BaseBubbleProps {
    title: string;
    icon?: React.ReactNode;
    badge?: React.ReactNode;
    defaultExpanded?: boolean;
    copyData?: string;
    collapsedSummary?: React.ReactNode;
    children: React.ReactNode;
    className?: string;
  }
  ```
- **ì¬ì‚¬ìš© ê°€ëŠ¥**: Tool ê´€ë ¨ ë©”ì‹œì§€ì— ì´ë¯¸ ì ìš©ë¨, ë³€ê²½ ë¶ˆí•„ìš”

### 2. UIResourceRenderer

**íŒŒì¼**: `@mcp-ui/client` (ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬)

- **ì£¼ìš” ê¸°ëŠ¥**: MCP UI Resource ë Œë”ë§ (remoteDom, rawHtml, externalUrl)
- **ì‚¬ìš© ìœ„ì¹˜**: `MessageRenderer.tsx` lines 436-467
- **ì£¼ì˜ì‚¬í•­**: ì´ ë¶€ë¶„ì€ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìœ ì§€

### 3. useClipboard Hook

**íŒŒì¼**: `src/hooks/useClipboard.ts`

- **ì£¼ìš” ê¸°ëŠ¥**: í´ë¦½ë³´ë“œ ë³µì‚¬ ê¸°ëŠ¥
- **ì¬ì‚¬ìš©**: Copy ë²„íŠ¼ êµ¬í˜„ì— ì´ë¯¸ ì‚¬ìš© ì¤‘

### 4. í…Œë§ˆ ê°ì§€ ë¡œì§

**í˜„ì¬ ìœ„ì¹˜**: `MessageBubble.tsx` lines 20-22

```tsx
const isDark =
  typeof window !== 'undefined' &&
  window.matchMedia('(prefers-color-scheme: dark)').matches;
```

- **ì¬ì‚¬ìš© ê°€ëŠ¥**: Syntax highlighting í…Œë§ˆ ì„ íƒì— í™œìš©

## ğŸ§ª Test Code ì¶”ê°€ ë° ìˆ˜ì • ê°€ì´ë“œ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

#### 1. MessageRenderer í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `src/components/__tests__/MessageRenderer.test.tsx` (ì‹ ê·œ ìƒì„±)

````tsx
import { render, screen } from '@testing-library/react';
import { MessageRenderer } from '../MessageRenderer';
import type { MCPContent } from '@/lib/mcp-types';

describe('MessageRenderer', () => {
  it('renders code blocks with overflow scroll', () => {
    const content: MCPContent[] = [
      {
        type: 'text',
        text: '```python\nprint("very long line that should trigger horizontal scroll" * 10)\n```',
      },
    ];

    const { container } = render(<MessageRenderer content={content} />);
    const preElement = container.querySelector('pre');

    expect(preElement).toHaveClass('overflow-x-auto');
    expect(preElement).toHaveClass('max-w-full');
  });

  it('renders inline code with proper styling', () => {
    const content: MCPContent[] = [
      { type: 'text', text: 'This is `inline code` test' },
    ];

    render(<MessageRenderer content={content} />);
    const codeElement = screen.getByText('inline code');

    expect(codeElement.tagName).toBe('CODE');
    expect(codeElement).toHaveClass('bg-muted');
  });

  it('renders long text with word break', () => {
    const longText = 'verylongtextwithoutspaces'.repeat(20);
    const content: MCPContent[] = [{ type: 'text', text: longText }];

    const { container } = render(<MessageRenderer content={content} />);
    const wrapper = container.firstChild as HTMLElement;

    expect(wrapper).toHaveClass('break-words');
  });
});
````

#### 2. MessageBubble ë ˆì´ì•„ì›ƒ í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `src/features/chat/__tests__/MessageBubble.test.tsx` (ì‹ ê·œ ìƒì„±)

```tsx
import { render } from '@testing-library/react';
import MessageBubble from '../MessageBubble';
import type { Message } from '@/models/chat';

describe('MessageBubble Layout', () => {
  it('applies compact bubble style for user messages', () => {
    const userMessage: Message = {
      id: '1',
      role: 'user',
      content: [{ type: 'text', text: 'Hello' }],
      createdAt: new Date(),
    };

    const { container } = render(<MessageBubble message={userMessage} />);

    const bubble = container.querySelector('[class*="max-w-[85%]"]');
    expect(bubble).toBeInTheDocument();
    expect(bubble).toHaveClass('rounded-2xl');
  });

  it('applies full-width style for assistant messages', () => {
    const assistantMessage: Message = {
      id: '2',
      role: 'assistant',
      content: [{ type: 'text', text: 'Response' }],
      createdAt: new Date(),
    };

    const { container } = render(<MessageBubble message={assistantMessage} />);

    const bubble = container.querySelector('[class*="w-full"]');
    expect(bubble).toBeInTheDocument();
    expect(bubble).toHaveClass('border-l-4');
  });
});
```

### í†µí•© í…ŒìŠ¤íŠ¸

#### ChatMessages í†µí•© í…ŒìŠ¤íŠ¸

**íŒŒì¼**: `src/features/chat/__tests__/ChatMessages.integration.test.tsx`

```tsx
describe('ChatMessages Integration', () => {
  it('renders loading state with animation', () => {
    // Mock isLoading = true
    render(<ChatMessages />);

    const loadingElement = screen.getByText(/Thinking and analyzing/i);
    expect(loadingElement).toBeInTheDocument();
    expect(loadingElement).toHaveClass('animate-pulse');

    const dots = screen.getAllByText('â—');
    expect(dots).toHaveLength(3);
  });

  it('scrolls to bottom on new message', async () => {
    const { rerender } = render(<ChatMessages />);

    // Add new message and verify scroll behavior
    // (êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ì€ ì‹¤ì œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ë§ê²Œ ì¡°ì •)
  });
});
```

### E2E í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (Manual Testing Checklist)

```markdown
## Chat UI Overflow & Layout Testing

### Code Block Overflow

- [ ] ê¸´ Python ì½”ë“œ ì…ë ¥ ì‹œ ìˆ˜í‰ ìŠ¤í¬ë¡¤ ìƒì„± í™•ì¸
- [ ] ê¸´ JavaScript ì½”ë“œ ì…ë ¥ ì‹œ ìˆ˜í‰ ìŠ¤í¬ë¡¤ ìƒì„± í™•ì¸
- [ ] Inline codeê°€ ì¤„ë°”ê¿ˆ ì—†ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- [ ] ì½”ë“œ ë¸”ë¡ì´ ë²„ë¸” ë°–ìœ¼ë¡œ ë„˜ì¹˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸

### Layout Differentiation

- [ ] User ë©”ì‹œì§€ê°€ ì˜¤ë¥¸ìª½ ì •ë ¬, ìµœëŒ€ 85% ë„ˆë¹„ í™•ì¸
- [ ] Agent ë©”ì‹œì§€ê°€ ì™¼ìª½ ì •ë ¬, ì „ì²´ ë„ˆë¹„ ì‚¬ìš© í™•ì¸
- [ ] Tool Outputì´ ì¤‘ê°„ í¬ê¸° ë²„ë¸”ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

### Loading State

- [ ] Streaming ì‹œì‘ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë¡œë”© í‘œì‹œ í™•ì¸
- [ ] "â—â—â—" ì  ì• ë‹ˆë©”ì´ì…˜ ì‘ë™ í™•ì¸
- [ ] Avatar ì•„ì´ì½˜ pulse íš¨ê³¼ í™•ì¸

### Markdown Rendering

- [ ] í—¤ë”©(h1, h2, h3) ìŠ¤íƒ€ì¼ ì ìš© í™•ì¸
- [ ] ë¦¬ìŠ¤íŠ¸(ul, ol) ë“¤ì—¬ì“°ê¸° í™•ì¸
- [ ] ì¸ìš©êµ¬(blockquote) ì™¼ìª½ í…Œë‘ë¦¬ í™•ì¸
- [ ] ë§í¬ê°€ ìƒˆ íƒ­ì—ì„œ ì—´ë¦¬ëŠ”ì§€ í™•ì¸

### Syntax Highlighting (Optional)

- [ ] Python ì½”ë“œ syntax highlighting í™•ì¸
- [ ] JavaScript/TypeScript ì½”ë“œ ì»¬ëŸ¬ë§ í™•ì¸
- [ ] ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œì—ì„œ í…Œë§ˆ ì „í™˜ í™•ì¸
```

## ğŸ“‹ ì‘ì—… ìˆœì„œ ì œì•ˆ

### Phase 1: Critical Overflow ìˆ˜ì • (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

1. MessageRenderer.tsxì˜ ReactMarkdown components ìŠ¤íƒ€ì¼ ì¶”ê°€
2. ì™¸ë¶€ ì»¨í…Œì´ë„ˆì— `overflow-x-hidden`, `break-words` ì¶”ê°€
3. ìˆ˜ë™ í…ŒìŠ¤íŠ¸: ê¸´ ì½”ë“œ ì…ë ¥ í›„ overflow í™•ì¸

### Phase 2: ë ˆì´ì•„ì›ƒ ì°¨ë³„í™” (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

4. MessageBubble.tsxì— ì—­í• ë³„ ìŠ¤íƒ€ì¼ í•¨ìˆ˜ ì¶”ê°€
5. User/Agent/Tool ë©”ì‹œì§€ ë Œë”ë§ í›„ ë ˆì´ì•„ì›ƒ í™•ì¸
6. ë°˜ì‘í˜• ë™ì‘ í…ŒìŠ¤íŠ¸ (ëª¨ë°”ì¼, íƒœë¸”ë¦¿, ë°ìŠ¤í¬í†±)

### Phase 3: Loading UI ê°œì„  (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

7. ChatMessages.tsxì˜ loading ìƒíƒœ UI êµì²´
8. ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ í™•ì¸
9. ì—¬ëŸ¬ ì—ì´ì „íŠ¸ ì´ë¦„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸

### Phase 4: Syntax Highlighting (ìš°ì„ ìˆœìœ„: ë‚®ìŒ, Optional)

10. react-syntax-highlighter ì˜ì¡´ì„± ì¶”ê°€
11. MessageRendererì— SyntaxHighlighter í†µí•©
12. ì£¼ìš” ì–¸ì–´(Python, JS, TS, Java, Rust) í…ŒìŠ¤íŠ¸
13. ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ í…Œë§ˆ ì „í™˜ í™•ì¸

### Phase 5: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

14. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
15. í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
16. E2E ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ
17. `pnpm refactor:validate` ì‹¤í–‰

## âš ï¸ ì£¼ì˜ ì‚¬í•­

### Breaking Changes ë°©ì§€

- `MessageRenderer`ì˜ ê¸°ì¡´ props interface ìœ ì§€
- `MessageBubble`ì˜ ì™¸ë¶€ API ë³€ê²½ ì—†ìŒ
- `BaseBubble`, `UIResourceRenderer` ë“± ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒ

### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

- ReactMarkdown componentsë¥¼ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ë¡œ ì •ì˜í•˜ë˜, ê°€ëŠ¥í•œ React.memo ì‚¬ìš©
- Syntax Highlightingì€ Optionalë¡œ ë‘ê³ , ì„±ëŠ¥ ì €í•˜ ì‹œ í† ê¸€ ê¸°ëŠ¥ ì¶”ê°€ ê³ ë ¤
- ê¸´ ë©”ì‹œì§€ ë Œë”ë§ ì‹œ virtual scrolling ê³ ë ¤ (ì¶”í›„ ê°œì„ )

### ì ‘ê·¼ì„± (Accessibility)

- ì½”ë“œ ë¸”ë¡ì— ì ì ˆí•œ `aria-label` ì¶”ê°€
- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì˜ì—­ì— í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì§€ì›
- ë¡œë”© ìƒíƒœ ì• ë‹ˆë©”ì´ì…˜ì´ `prefers-reduced-motion` ì¡´ì¤‘

### í˜¸í™˜ì„±

- Tauri í™˜ê²½ì—ì„œ window.matchMedia ì‚¬ìš© í™•ì¸
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(react-syntax-highlighter)ì˜ ë²ˆë“¤ í¬ê¸° í™•ì¸
- ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜ ì‹œ ê¹œë¹¡ì„ ì—†ëŠ”ì§€ í™•ì¸

## ğŸ“Š ì¶”ê°€ ë¶„ì„ ê³¼ì œ

ì‘ì—…ìê°€ êµ¬í˜„ ì¤‘ ì¶”ê°€ë¡œ í™•ì¸í•´ì•¼ í•  ì‚¬í•­ë“¤:

### 1. Markdown ë Œë”ë§ ìµœì í™”

- **ì§ˆë¬¸**: ë§¤ìš° ê¸´ ë©”ì‹œì§€(ìˆ˜ì²œ ì¤„ ì½”ë“œ)ì—ì„œ ReactMarkdown ì„±ëŠ¥ì€?
- **ë¶„ì„ ë°©í–¥**:
  - í•„ìš”ì‹œ lazy loadingì´ë‚˜ virtualization ê³ ë ¤
  - `react-window`ë‚˜ `react-virtualized` ì‚¬ìš© ê²€í† 

### 2. ìŠ¤íŠ¸ë¦¬ë° ì¤‘ ë ˆì´ì•„ì›ƒ Shift

- **ì§ˆë¬¸**: Agent ë©”ì‹œì§€ê°€ streamingë˜ëŠ” ë™ì•ˆ ë ˆì´ì•„ì›ƒì´ íŠ€ì§€ ì•ŠëŠ”ê°€?
- **ë¶„ì„ ë°©í–¥**:
  - `message.isStreaming` ìƒíƒœì—ì„œ ìŠ¤íƒ€ì¼ ì¼ê´€ì„± í™•ì¸
  - í•„ìš”ì‹œ ìµœì†Œ ë†’ì´(min-height) ì„¤ì •

### 3. ëª¨ë°”ì¼ ë°˜ì‘í˜• ë™ì‘

- **ì§ˆë¬¸**: ì‘ì€ í™”ë©´ì—ì„œ ì „ì²´ ë„ˆë¹„ Agent ë©”ì‹œì§€ê°€ ì ì ˆí•œê°€?
- **ë¶„ì„ ë°©í–¥**:
  - 768px ì´í•˜ì—ì„œ íŒ¨ë”© ì¡°ì • í•„ìš”ì„± ê²€í† 
  - ëª¨ë°”ì¼ì—ì„œ ìˆ˜í‰ ìŠ¤í¬ë¡¤ ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸

### 4. Tool Outputì˜ UI Resource

- **ì§ˆë¬¸**: ToolOutputBubbleì—ì„œ `expandResources={true}` ì „ë‹¬ ì‹œ ë¬¸ì œ ì—†ëŠ”ê°€?
- **ë¶„ì„ ë°©í–¥**:
  - `ToolOutputBubble.tsx` line 26ì˜ `expandResources` prop ë™ì‘ í™•ì¸
  - Resourceê°€ ë§¤ìš° í´ ë•Œ ìŠ¤í¬ë¡¤ ë™ì‘ ê²€ì¦

### 5. Copy ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì •

- **ì§ˆë¬¸**: ì „ì²´ ë„ˆë¹„ Agent ë©”ì‹œì§€ì—ì„œ Copy ë²„íŠ¼ì´ ì ì ˆí•œ ìœ„ì¹˜ì— ìˆëŠ”ê°€?
- **ë¶„ì„ ë°©í–¥**:
  - `MessageRenderer.tsx` line 389ì˜ Copy ë²„íŠ¼ì´ ì˜ ë³´ì´ëŠ”ì§€ í™•ì¸
  - í•„ìš”ì‹œ sticky position ê³ ë ¤

## ğŸ¯ Clarification Q-list

êµ¬í˜„ ì „ ì‚¬ìš©ìì˜ ì˜ì‚¬ ê²°ì •ì´ í•„ìš”í•œ ì‚¬í•­ë“¤:

### Q1: Syntax Highlighting ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ

**ì§ˆë¬¸**: `react-syntax-highlighter`ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ê°€, ì•„ë‹ˆë©´ ë” ê°€ë²¼ìš´ ëŒ€ì•ˆì„ ì‚¬ìš©í•  ê²ƒì¸ê°€?

- **ì˜µì…˜ A**: `react-syntax-highlighter` (í’ë¶€í•œ ê¸°ëŠ¥, ë²ˆë“¤ í¬ê¸° í¼)
- **ì˜µì…˜ B**: `prism-react-renderer` (ê°€ë²¼ì›€, ì œí•œì  ì–¸ì–´ ì§€ì›)
- **ì˜µì…˜ C**: Syntax highlighting ì œì™¸í•˜ê³  ë‹¨ìˆœ ìŠ¤íƒ€ì¼ë§Œ (Phase 4 ìƒëµ)

**ê¶Œì¥**: ì˜µì…˜ A (react-syntax-highlighter) - ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ê³  ì•ˆì •ì 

### Q2: Agent ë©”ì‹œì§€ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼

**ì§ˆë¬¸**: Agent ë©”ì‹œì§€ì— ë²„ë¸” ìŠ¤íƒ€ì¼ì„ ì™„ì „íˆ ì œê±°í•  ê²ƒì¸ê°€, ìµœì†Œí•œìœ¼ë¡œ ìœ ì§€í•  ê²ƒì¸ê°€?

- **ì˜µì…˜ A**: ì™„ì „ ì œê±° (ChatGPT ìŠ¤íƒ€ì¼, í‰í‰í•œ ë ˆì´ì•„ì›ƒ)
- **ì˜µì…˜ B**: ìµœì†Œ ìœ ì§€ (border-l-4, ì•½ê°„ì˜ ë°°ê²½ìƒ‰)
- **ì˜µì…˜ C**: í˜„ì¬ì²˜ëŸ¼ ë²„ë¸” ìœ ì§€, ë„ˆë¹„ë§Œ í™•ì¥

**ê¶Œì¥**: ì˜µì…˜ B - êµ¬ë¶„ì„ ìœ„í•œ ìµœì†Œí•œì˜ ì‹œê°ì  ìš”ì†Œ ìœ ì§€

### Q3: Loading UI ì• ë‹ˆë©”ì´ì…˜ ê°•ë„

**ì§ˆë¬¸**: "Thinking..." ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ì„ ì–¼ë§ˆë‚˜ ë™ì ìœ¼ë¡œ ë§Œë“¤ ê²ƒì¸ê°€?

- **ì˜µì…˜ A**: ë‹¨ìˆœ ì  ì• ë‹ˆë©”ì´ì…˜ (ì œì•ˆëœ ì½”ë“œ)
- **ì˜µì…˜ B**: ë‹¨ê³„ë³„ ë©”ì‹œì§€ ë³€ê²½ ("Thinking..." â†’ "Analyzing..." â†’ "Generating...")
- **ì˜µì…˜ C**: Progress bar ì¶”ê°€

**ê¶Œì¥**: ì˜µì…˜ Aë¡œ ì‹œì‘, ì‚¬ìš©ì í”¼ë“œë°± í›„ ì˜µì…˜ B ê³ ë ¤

### Q4: ëª¨ë°”ì¼ì—ì„œ Agent ë©”ì‹œì§€ ë„ˆë¹„

**ì§ˆë¬¸**: ëª¨ë°”ì¼ í™”ë©´(< 768px)ì—ì„œë„ Agent ë©”ì‹œì§€ê°€ ì „ì²´ ë„ˆë¹„ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?

- **ì˜µì…˜ A**: ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ ì „ì²´ ë„ˆë¹„
- **ì˜µì…˜ B**: ëª¨ë°”ì¼ì—ì„œëŠ” Userì²˜ëŸ¼ ì œí•œëœ ë„ˆë¹„ (max-w-[95%])

**ê¶Œì¥**: ì˜µì…˜ A - ì¼ê´€ì„± ìœ ì§€, ë‹¨ íŒ¨ë”© ì¡°ì •

### Q5: í…ŒìŠ¤íŠ¸ ë²”ìœ„

**ì§ˆë¬¸**: ì–´ëŠ ìˆ˜ì¤€ê¹Œì§€ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ê²ƒì¸ê°€?

- **ì˜µì…˜ A**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë§Œ (Phase 5ì˜ ì¼ë¶€)
- **ì˜µì…˜ B**: ë‹¨ìœ„ + í†µí•© í…ŒìŠ¤íŠ¸
- **ì˜µì…˜ C**: ë‹¨ìœ„ + í†µí•© + E2E ìë™í™”

**ê¶Œì¥**: ì˜µì…˜ B - í•µì‹¬ ê¸°ëŠ¥ì— ëŒ€í•œ ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸, E2EëŠ” ìˆ˜ë™

---

**ë‹¤ìŒ ë‹¨ê³„**: ìœ„ Clarification Q-listì— ëŒ€í•œ ê²°ì • í›„ Phase 1ë¶€í„° ìˆœì°¨ ì§„í–‰
