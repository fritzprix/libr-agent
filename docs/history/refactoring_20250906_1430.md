# Planning Server UIResource Integration Refactoring Plan

## ì‘ì—…ì˜ ëª©ì 

Planning Serverì˜ todo/goal ì—…ë°ì´íŠ¸ ë„êµ¬ ì‚¬ìš© ì‹œ, í˜„ì¬ ëª©í‘œì™€ í•  ì¼ ëª©ë¡ì˜ ì „ì²´ í˜„í™©ì„ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” UIResourceë¥¼ ì‘ë‹µì— í¬í•¨í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•©ë‹ˆë‹¤.

## í˜„ì¬ì˜ ìƒíƒœ / ë¬¸ì œì 

### 1. í˜„ì¬ ì‘ë‹µ êµ¬ì¡°

- Planning Serverì˜ ëª¨ë“  ë„êµ¬ëŠ” `normalizeToolResult`ë¥¼ í†µí•´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‘ë‹µë§Œ ë°˜í™˜
- Goal/Todo ì—…ë°ì´íŠ¸ í›„ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•˜ë ¤ë©´ ë³„ë„ì˜ `list_todos` ë„êµ¬ë¥¼ í˜¸ì¶œí•´ì•¼ í•¨
- ì‹œê°ì  í”¼ë“œë°± ë¶€ì¬ë¡œ ì‚¬ìš©ìê°€ ì „ì²´ ì§„í–‰ ìƒí™©ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€

### 2. ê¸°ìˆ ì  ì œì•½ì‚¬í•­

- ê¸°ì¡´ `normalizeToolResult` íŒ¨í„´ì„ ìœ ì§€í•´ì•¼ í•¨ (ì¼ê´€ì„±)
- `@mcp-ui/server`ë¥¼ í™œìš©í•œ í‘œì¤€ UIResource ìƒì„± í•„ìš”
- MCPResponse êµ¬ì¡°ì™€ MCPContent íƒ€ì… ì¤€ìˆ˜ í•„ìš”

## ì¶”ê°€ ë¶„ì„ ê³¼ì œ

1. **UIResource HTML í…œí”Œë¦¿ ìµœì í™”**
   - ë‹¤ì–‘í•œ Goal/Todo ìƒíƒœì— ëŒ€í•œ ì‹œê°ì  í‘œí˜„ ë°©ì‹ ê²€í† 
   - ë°˜ì‘í˜• ë””ìì¸ ë° ì ‘ê·¼ì„± ê³ ë ¤ì‚¬í•­ ë¶„ì„

2. **ì„±ëŠ¥ ì˜í–¥ë„ ë¶„ì„**
   - HTML ìƒì„± ë¹„ìš©ê³¼ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê²€í† 
   - ëŒ€ëŸ‰ì˜ Todo í•­ëª© ì²˜ë¦¬ ì‹œ ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ

## ë³€ê²½ ì´í›„ì˜ ìƒíƒœ / í•´ê²° íŒì • ê¸°ì¤€

### ì„±ê³µ ê¸°ì¤€

1. `create_goal`, `update_goal`, `add_todo`, `update_todo` ë„êµ¬ ì‹¤í–‰ ì‹œ UIResourceê°€ ì‘ë‹µì— í¬í•¨ë¨
2. UIResourceëŠ” í˜„ì¬ Goalê³¼ ëª¨ë“  Todoì˜ ìƒíƒœë¥¼ HTML í˜•íƒœë¡œ í‘œì‹œ
3. ê¸°ì¡´ í…ìŠ¤íŠ¸ ì‘ë‹µë„ ìœ ì§€ë˜ì–´ API í˜¸í™˜ì„± ë³´ì¥
4. `@mcp-ui/server`ì˜ í‘œì¤€ êµ¬ì¡°ë¥¼ ì¤€ìˆ˜í•˜ì—¬ MCP-UI í˜¸í™˜ì„± í™•ë³´
5. ê¸°ì¡´ `normalizeToolResult` íŒ¨í„´ê³¼ ì¼ê´€ì„± ìœ ì§€

### ê²€ì¦ ë°©ë²•

- Goal ìƒì„±/ìˆ˜ì • í›„ HTML í˜•íƒœì˜ í˜„í™© í‘œì‹œ í™•ì¸
- Todo ì¶”ê°€/ìˆ˜ì • í›„ ì „ì²´ ëª©ë¡ì˜ ì‹œê°ì  í‘œì‹œ í™•ì¸
- ê¸°ì¡´ ë„êµ¬ë“¤ì˜ ë™ì‘ ë³€ê²½ ì—†ìŒ í™•ì¸

## ìˆ˜ì •ì´ í•„ìš”í•œ ì½”ë“œ ë° ìˆ˜ì •ë¶€ë¶„ì˜ ì½”ë“œ ìŠ¤ë‹ˆí•

### 1. Planning Server Import ì¶”ê°€

**íŒŒì¼:** `src/lib/web-mcp/modules/planning-server.ts`

```typescript
// ì¶”ê°€í•  import
import { createUIResource } from '@mcp-ui/server';
import type { UIResource } from '@mcp-ui/server';
```

### 2. HTML ìƒì„± í—¬í¼ í•¨ìˆ˜ ì¶”ê°€

```typescript
/**
 * Goalê³¼ Todo í˜„í™©ì„ HTMLë¡œ ìƒì„±
 */
function generateGoalTodosHTML(goal: Goal | null, todos: Todo[]): string {
  const goalSection = goal
    ? `
      <div class="goal-section" style="margin-bottom: 16px; padding: 12px; border-left: 4px solid #2563eb; background: #f8fafc;">
        <h3 style="margin: 0 0 8px 0; color: #1e40af;">ğŸ¯ Current Goal</h3>
        <div style="font-weight: bold; color: #1f2937;">${goal.name}</div>
        ${goal.description ? `<div style="color: #6b7280; margin-top: 4px;">${goal.description}</div>` : ''}
        <div style="margin-top: 8px;">
          <span style="padding: 2px 8px; border-radius: 12px; font-size: 12px; background: ${
            goal.status === 'completed'
              ? '#dcfce7; color: #166534'
              : goal.status === 'paused'
                ? '#fef3c7; color: #92400e'
                : '#dbeafe; color: #1d4ed8'
          };">
            ${goal.status}
          </span>
        </div>
      </div>
    `
    : `
      <div class="goal-section" style="margin-bottom: 16px; padding: 12px; border-left: 4px solid #d1d5db; background: #f9fafb;">
        <h3 style="margin: 0; color: #6b7280;">ğŸ¯ No Active Goal</h3>
      </div>
    `;

  const todosSection = `
    <div class="todos-section">
      <h3 style="margin: 0 0 12px 0; color: #1f2937;">ğŸ“‹ Todo List (${todos.length})</h3>
      ${
        todos.length === 0
          ? '<div style="color: #6b7280; font-style: italic;">No todos yet</div>'
          : todos
              .map(
                (todo) => `
          <div style="margin-bottom: 8px; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; background: #ffffff;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="padding: 2px 6px; border-radius: 8px; font-size: 11px; background: ${
                todo.status === 'completed'
                  ? '#dcfce7; color: #166534'
                  : todo.status === 'in_progress'
                    ? '#fef3c7; color: #92400e'
                    : '#f3f4f6; color: #374151'
              };">
                ${todo.status}
              </span>
              <span style="font-weight: 500; color: #1f2937;">${todo.name}</span>
            </div>
            ${todo.description ? `<div style="margin-top: 4px; color: #6b7280; font-size: 14px;">${todo.description}</div>` : ''}
          </div>
        `,
              )
              .join('')
      }
    </div>
  `;

  return `
    <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0; padding: 16px; line-height: 1.5;">
      <h2 style="margin: 0 0 16px 0; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">
        ğŸ“Š Goals & Todos Overview
      </h2>
      ${goalSection}
      ${todosSection}
      <div style="margin-top: 16px; padding: 8px; background: #f3f4f6; border-radius: 6px; font-size: 12px; color: #6b7280;">
        Last updated: ${new Date().toLocaleString()}
      </div>
    </div>
  `;
}
```

### 3. UIResource ìƒì„± í—¬í¼ í•¨ìˆ˜ ì¶”ê°€

```typescript
/**
 * Goal/Todo UIResource ìƒì„±
 */
function createGoalTodosUIResource(
  goal: Goal | null,
  todos: Todo[],
): UIResource {
  const htmlContent = generateGoalTodosHTML(goal, todos);

  return createUIResource({
    uri: `ui://planning/overview/${Date.now()}`,
    content: {
      type: 'rawHtml',
      htmlString: htmlContent,
    },
    encoding: 'text',
  });
}
```

### 4. normalizeToolResult í™•ì¥ í•¨ìˆ˜ ì¶”ê°€

```typescript
/**
 * UIResourceë¥¼ í¬í•¨í•œ Tool ê²°ê³¼ ì •ê·œí™”
 */
function normalizeToolResultWithUI(
  result: unknown,
  toolName: string,
  uiResource?: UIResource,
): MCPResponse {
  const baseResponse = normalizeToolResult(result, toolName);

  if (uiResource && baseResponse.result?.content) {
    // UIResourceë¥¼ content ë°°ì—´ ì•ìª½ì— ì¶”ê°€
    baseResponse.result.content.unshift({
      type: 'resource',
      resource: uiResource,
    });
  }

  return baseResponse;
}
```

### 5. callTool ë©”ì„œë“œ ìˆ˜ì •

```typescript
// ê¸°ì¡´ ì½”ë“œì—ì„œ ìˆ˜ì •í•  ë¶€ë¶„
async callTool(name: string, args: unknown): Promise<MCPResponse> {
  const typedArgs = args as Record<string, unknown>;

  switch (name) {
    case 'create_goal': {
      const result = state.createGoal(
        typedArgs.name as string,
        typedArgs.description as string,
      );
      const uiResource = createGoalTodosUIResource(state.getGoal(), state.listTodos());
      return normalizeToolResultWithUI(result, 'create_goal', uiResource);
    }

    case 'update_goal': {
      const result = state.updateGoal(
        typedArgs.updates as Partial<Pick<Goal, 'name' | 'description' | 'status'>>,
      );
      const uiResource = createGoalTodosUIResource(state.getGoal(), state.listTodos());
      return normalizeToolResultWithUI(result, 'update_goal', uiResource);
    }

    case 'add_todo': {
      const result = state.addTodo(
        typedArgs.name as string,
        typedArgs.description as string,
      );
      const uiResource = createGoalTodosUIResource(state.getGoal(), state.listTodos());
      return normalizeToolResultWithUI(result, 'add_todo', uiResource);
    }

    case 'update_todo': {
      const result = state.updateTodo(
        typedArgs.todoId as number,
        typedArgs.updates as Partial<Pick<Todo, 'name' | 'description' | 'status'>>,
      );
      const uiResource = createGoalTodosUIResource(state.getGoal(), state.listTodos());
      return normalizeToolResultWithUI(result, 'update_todo', uiResource);
    }

    // ê¸°ì¡´ ì¼€ì´ìŠ¤ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
    default:
      // ... ê¸°ì¡´ ë¡œì§
  }
}
```

## ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ê´€ ì½”ë“œ

### ê´€ë ¨ íŒŒì¼ ë° ì¸í„°í˜ì´ìŠ¤

1. **í•µì‹¬ íŒŒì¼:**
   - `src/lib/web-mcp/modules/planning-server.ts` - ë©”ì¸ ìˆ˜ì • ëŒ€ìƒ
   - `src/lib/mcp-types.ts` - MCPResponse, UIResource íƒ€ì… ì •ì˜

2. **ì˜ì¡´ì„±:**
   - `@mcp-ui/server` - createUIResource í•¨ìˆ˜
   - `@mcp-ui/server/types` - UIResource, CreateUIResourceOptions íƒ€ì…

3. **ì¬ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨í„´:**
   - `normalizeToolResultWithUI` í•¨ìˆ˜ëŠ” ë‹¤ë¥¸ MCP ì„œë²„ì—ì„œë„ í™œìš© ê°€ëŠ¥
   - HTML ìƒì„± íŒ¨í„´ì€ ë‹¤ë¥¸ ìƒíƒœ í‘œì‹œ UIì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥

### ì£¼ìš” ì¸í„°í˜ì´ìŠ¤

```typescript
// @mcp-ui/serverì—ì„œ ì œê³µ
interface CreateUIResourceOptions {
  uri: `ui://${string}`;
  content: {
    type: 'rawHtml';
    htmlString: string;
  };
  encoding: 'text' | 'blob';
}

// í˜„ì¬ ì‹œìŠ¤í…œì˜ UIResource (í˜¸í™˜ë¨)
interface UIResource {
  uri?: string;
  mimeType: string;
  text?: string;
  blob?: string;
  title?: string;
  annotations?: Record<string, unknown>;
}
```

## êµ¬í˜„ ë‹¨ê³„

1. **Phase 1:** Import ë° í—¬í¼ í•¨ìˆ˜ ì¶”ê°€
2. **Phase 2:** normalizeToolResultWithUI í•¨ìˆ˜ êµ¬í˜„
3. **Phase 3:** callTool ë©”ì„œë“œì˜ í•´ë‹¹ ì¼€ì´ìŠ¤ë“¤ ìˆ˜ì •
4. **Phase 4:** í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

ì´ ê³„íšì€ ê¸°ì¡´ ì½”ë“œ êµ¬ì¡°ì™€ íŒ¨í„´ì„ ìµœëŒ€í•œ ìœ ì§€í•˜ë©´ì„œë„ MCP-UI í‘œì¤€ì„ ì¤€ìˆ˜í•˜ëŠ” UIResource í†µí•©ì„ ì œê³µí•©ë‹ˆë‹¤.
