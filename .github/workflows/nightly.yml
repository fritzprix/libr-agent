name: ğŸŒ™ Nightly Build

on:
  schedule:
    # Run every day at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  nightly:
    name: ğŸŒ™ Nightly Build
    runs-on: ${{ matrix.platform }}
    strategy:
      fail-fast: false
      matrix:
        platform: [macos-latest, ubuntu-latest, windows-latest]
    
    steps:
      - name: ï¿½ Setup Environment
        uses: ./.github/actions/setup-tauri-env
        with:
          install-tauri-deps: ${{ matrix.platform == 'ubuntu-latest' && 'true' || 'false' }}
          node-version: 'lts/*'

      - name: ğŸ—ï¸ Build the app
        run: pnpm tauri build

      - name: ğŸ“¦ Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: nightly-build-${{ matrix.platform }}
          path: |
            src-tauri/target/release/bundle/
          retention-days: 7

  notify:
    name: ğŸ“¢ Notify Build Status
    needs: nightly
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“¢ Build Success
        if: needs.nightly.result == 'success'
        run: echo "âœ… Nightly build completed successfully"
        
      - name: ğŸ“¢ Build Failed
        if: needs.nightly.result == 'failure'
        run: echo "âŒ Nightly build failed"
